{% load static %}

<!-- User Sidebar -->
<div id="user-sidebar" class="bg-slate-800 text-white flex flex-col z-30" style="width: 256px; min-height: 100vh; position: sticky; top: 0;">
    <!-- Logo/Brand -->
    <div class="p-4 flex items-center justify-between">
        <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M5.5 16a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 16h-8z"></path>
                </svg>
            </div>
            <div class="sidebar-text">
                <h2 class="text-base font-bold text-white">ClimaChat</h2>
                <p class="text-xs text-gray-300">Weather Assistant</p>
            </div>
        </div>
        <button id="sidebar-toggle" class="text-gray-400 hover:text-white transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>
            </svg>
        </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-4 pb-4">
        <div class="space-y-1">
            <!-- Dashboard -->
            <a href="{% url 'user_dashboard' %}" class="{% if request.resolver_match.url_name == 'user_dashboard' %}bg-blue-600 text-white border-l-4 border-blue-400{% else %}text-gray-300 hover:bg-slate-700 hover:text-white{% endif %} flex items-center px-4 py-3 rounded-lg transition-all duration-200 relative group" title="Dashboard">
                <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"></path>
                </svg>
                <span class="font-medium sidebar-text">Dashboard</span>
                <span class="sidebar-tooltip">Dashboard</span>
                {% if request.resolver_match.url_name == 'user_dashboard' %}
                <div class="absolute right-2 w-2 h-2 bg-blue-400 rounded-full"></div>
                {% endif %}
            </a>

            <!-- Weather Chat -->
            <a href="{% url 'user_chat' %}" class="{% if request.resolver_match.url_name == 'user_chat' %}bg-blue-600 text-white border-l-4 border-blue-400{% else %}text-gray-300 hover:bg-slate-700 hover:text-white{% endif %} flex items-center px-4 py-3 rounded-lg transition-all duration-200 relative group" title="Weather Chat">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                <span class="font-medium sidebar-text">Weather Chat</span>
                <span class="sidebar-tooltip">Weather Chat</span>
                {% if request.resolver_match.url_name == 'user_chat' %}
                <div class="absolute right-2 w-2 h-2 bg-blue-400 rounded-full"></div>
                {% endif %}
            </a>

            <!-- Weather Map -->
            <a href="{% url 'weather_map' %}" class="{% if request.resolver_match.url_name == 'weather_map' %}bg-blue-600 text-white border-l-4 border-blue-400{% else %}text-gray-300 hover:bg-slate-700 hover:text-white{% endif %} flex items-center px-4 py-3 rounded-lg transition-all duration-200 relative group" title="Weather Map">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span class="font-medium sidebar-text">Weather Map</span>
                <span class="sidebar-tooltip">Weather Map</span>
                {% if request.resolver_match.url_name == 'weather_map' %}
                <div class="absolute right-2 w-2 h-2 bg-blue-400 rounded-full"></div>
                {% endif %}
            </a>

            <!-- Health Tips -->
            <a href="{% url 'health_tips' %}" class="{% if request.resolver_match.url_name == 'health_tips' %}bg-blue-600 text-white border-l-4 border-blue-400{% else %}text-gray-300 hover:bg-slate-700 hover:text-white{% endif %} flex items-center px-4 py-3 rounded-lg transition-all duration-200 relative group" title="Health & Safety">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                <span class="font-medium sidebar-text">Health & Safety</span>
                <span class="sidebar-tooltip">Health & Safety</span>
                {% if request.resolver_match.url_name == 'health_tips' %}
                <div class="absolute right-2 w-2 h-2 bg-blue-400 rounded-full"></div>
                {% endif %}
            </a>
        </div>

        <!-- Bottom Section -->
        <div class="mt-auto pt-6 space-y-1">
            <!-- Profile -->
            <a href="{% url 'user_profile' %}" class="{% if request.resolver_match.url_name == 'user_profile' %}bg-blue-600 text-white border-l-4 border-blue-400{% else %}text-gray-300 hover:bg-slate-700 hover:text-white{% endif %} flex items-center px-4 py-3 rounded-lg transition-all duration-200 relative group" title="Profile">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span class="font-medium sidebar-text">Profile</span>
                <span class="sidebar-tooltip">Profile</span>
                {% if request.resolver_match.url_name == 'user_profile' %}
                <div class="absolute right-2 w-2 h-2 bg-blue-400 rounded-full"></div>
                {% endif %}
            </a>

            <!-- Logout -->
            <a href="{% url 'user_logout' %}" class="flex items-center px-4 py-3 text-gray-300 hover:bg-slate-700 hover:text-white rounded-lg transition-all duration-200 relative group" title="Logout">
                <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                <span class="font-medium sidebar-text">Logout</span>
                <span class="sidebar-tooltip">Logout</span>
            </a>
        </div>
    </nav>
</div>

<style>
/* Sidebar transitions */
#user-sidebar {
    transition: width 0.3s ease;
}

#user-sidebar.collapsed {
    width: 70px !important;
}

#user-sidebar.collapsed .sidebar-text {
    display: none;
}

#user-sidebar.collapsed #sidebar-toggle svg {
    transform: rotate(180deg);
}

/* Center icons when collapsed */
#user-sidebar.collapsed nav a {
    justify-content: center;
    padding-left: 0;
    padding-right: 0;
}

#user-sidebar.collapsed nav a svg {
    margin-right: 0;
}

/* Hide active indicator dot when collapsed */
#user-sidebar.collapsed .absolute.right-2 {
    display: none;
}

/* Hide border when collapsed */
#user-sidebar.collapsed nav a.border-l-4 {
    border-left-width: 0;
}

/* Center logo icon when collapsed */
#user-sidebar.collapsed .p-4 {
    justify-content: center;
}

/* Tooltip styling */
.sidebar-tooltip {
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    margin-left: 12px;
    padding: 6px 12px;
    background-color: #1e293b;
    color: white;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 6px;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.2s, visibility 0.2s;
    z-index: 1000;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Tooltip arrow */
.sidebar-tooltip::before {
    content: '';
    position: absolute;
    right: 100%;
    top: 50%;
    transform: translateY(-50%);
    border: 6px solid transparent;
    border-right-color: #1e293b;
}

/* Show tooltip on hover when collapsed */
#user-sidebar.collapsed nav a:hover .sidebar-tooltip {
    opacity: 1;
    visibility: visible;
}

/* Hide tooltip when sidebar is not collapsed */
#user-sidebar:not(.collapsed) .sidebar-tooltip {
    display: none;
}
</style>

<script>
(function() {
    const sidebar = document.getElementById('user-sidebar');
    const toggleBtn = document.getElementById('sidebar-toggle');

    if (!sidebar || !toggleBtn) return;

    // Load saved state
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
        sidebar.classList.add('collapsed');
    }

    // Toggle sidebar on button click
    toggleBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        sidebar.classList.toggle('collapsed');

        const nowCollapsed = sidebar.classList.contains('collapsed');
        localStorage.setItem('sidebarCollapsed', nowCollapsed.toString());
    });
})();
</script>