{% extends 'admin/layouts/base.html' %}

{% block title %}Weather Map - ClimaChat Admin{% endblock %}

{% block page_title %}Weather Map{% endblock %}
{% block page_subtitle %}Interactive weather visualization and monitoring{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
<div class="space-y-4">
    {% include 'admin/components/map/weather_controls.html' %}
    {% include 'admin/components/map/map_container.html' %}
</div>

<!-- Weather Alert Modal Component -->
{% include 'admin/components/map/weather_alert_modal.html' %}
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Set API key from Django settings before loading map modules
window.OPENWEATHER_API_KEY_FROM_ENV = "{{ OPENWEATHER_API_KEY }}";
</script>

<!-- Load map modules in correct order -->
{% load static %}
{% now "U" as cache_bust %}
<script src="{% static 'js/map/map_config.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/map_utils.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/map_layers.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/weather_overlays.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/weather_data.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/map_controls.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/admin_features.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/weather_alert_modal.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/admin_user_markers.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/minimap.js' %}?v={{ cache_bust }}"></script>
<script src="{% static 'js/map/map_init.js' %}?v={{ cache_bust }}"></script>
{% endblock %}
